---
description: Any time tests need to be run for the Home Assistant python or javascript code in the tasktracker-hass-integration directory.
alwaysApply: false
---

# Testing Rules for TaskTracker Home Assistant Integration

These rules standardize how to execute *all* automated tests so you never need to figure out the commands again.

## 1. Activate the Virtual Environment

1. Ensure you are in the `tasktracker-hass-integration` directory.

2. In the `tasktracker-hass-integration` directory run `source .venv/bin/activate` to activate the virtualenv.
   (Re-activating is harmless if you are already inside the venv.)

## 2. Run Tests

### 2.1. Python Tests

**CRITICAL:** Always use the `run_tests.py` helper script to run tests instead of running pytest directly. This script:
- Checks for required test dependencies
- Runs pytest with proper coverage configuration
- Provides clear error messages for missing dependencies
- Generates HTML coverage reports

#### Running Python Tests

```bash
python run_tests.py
```

#### Test Structure
- Tests are located in the `tasktracker-hass-integration/tests/` directory
- Use `pytest` fixtures and patterns consistent with Home Assistant testing
- Use `jest` patterns for javascript testing.
- Mock external API calls from Python code using `aioresponses`
- Test both success and error scenarios for all service calls

#### DO NOT:
- Run `pytest` directly without using `run_tests.py`
- Install test dependencies globally if using a virtual environment
- Skip testing after making changes to service functions or utility code

#### Coverage Reports
The python test runner automatically generates:
- Terminal coverage report
- HTML coverage report in `htmlcov/index.html`
Always check coverage reports to ensure new code is properly tested.

### 2.2. Javascript Tests

#### Running Javascript Tests

```bash
# Run tests with coverage (default)
npm test

# Run tests without coverage (faster for development)
npm run test:no-coverage

# Run tests in watch mode
npm run test:watch
```

#### Test Structure
- Tests are located in the `tasktracker-hass-integration/tests/` directory
- Use `jest` patterns for javascript testing
- Test environment is `jsdom` to support DOM operations

#### Coverage Reports
The javascript test runner automatically generates:
- Terminal coverage report
- HTML coverage report in `coverage/index.html`
- LCOV coverage report in `coverage/lcov-report/index.html`

Always check coverage reports to ensure new code is properly tested.

## 3. Before & After Changes
- ALWAYS run tests before editing code to establish a baseline.
- Run the suite again after modifications; *all tests must pass* before committing.

## 4. Troubleshooting
- Import errors? Ensure the virtualenv is active **and** you are inside `tasktracker-hass-integration`.
